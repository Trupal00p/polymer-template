"use strict";var gulp=require("gulp"),$=require("gulp-load-plugins")(),del=require("del"),runSequence=require("run-sequence"),browserSync=require("browser-sync"),reload=browserSync.reload,merge=require("merge-stream"),path=require("path"),fs=require("fs"),glob=require("glob"),run=require("gulp-run"),greplace=require("gulp-replace"),AUTOPREFIXER_BROWSERS=["ie >= 10","ie_mob >= 10","ff >= 30","chrome >= 34","safari >= 7","opera >= 23","ios >= 7","android >= 4.4","bb >= 10"],styleTask=function(e,s){return gulp.src(s.map(function(s){return path.join("app",e,s)})).pipe($.changed(e,{extension:".css"})).pipe($.autoprefixer(AUTOPREFIXER_BROWSERS)).pipe(gulp.dest(".tmp/"+e)).pipe($["if"]("*.css",$.cssmin())).pipe(gulp.dest("dist/"+e)).pipe($.size({title:e}))};gulp.task("styles",function(){return styleTask("styles",["**/*.css"])}),gulp.task("elements",function(){return styleTask("elements",["**/*.css"])}),gulp.task("jshint",function(){return gulp.src(["app/scripts/**/*.js","app/elements/**/*.js","app/elements/**/*.html"]).pipe(reload({stream:!0,once:!0})).pipe($.jshint.extract()).pipe($.jshint()).pipe($.jshint.reporter("jshint-stylish")).pipe($["if"](!browserSync.active,$.jshint.reporter("fail")))}),gulp.task("images",function(){return gulp.src("app/images/**/*").pipe($.cache($.imagemin({progressive:!0,interlaced:!0}))).pipe(gulp.dest("dist/images")).pipe($.size({title:"images"}))}),gulp.task("copy",function(){var e=gulp.src(["app/*","!app/test","!app/precache.json"],{dot:!0}).pipe(greplace("static_dir: ../bower_components","static_dir: bower_components")).pipe(gulp.dest("dist")),s=gulp.src(["bower_components/**/*"]).pipe(gulp.dest("dist/bower_components")),t=gulp.src(["app/elements/**/*.html"]).pipe(gulp.dest("dist/elements")),p=gulp.src(["bower_components/platinum-sw/bootstrap/*.js"]).pipe(gulp.dest("dist/elements/bootstrap")),i=gulp.src(["bower_components/sw-toolbox/*.js"]).pipe(gulp.dest("dist/sw-toolbox")),n=gulp.src(["app/elements/elements.html"]).pipe($.rename("elements.vulcanized.html")).pipe(gulp.dest("dist/elements"));return merge(e,s,t,n,p,i).pipe($.size({title:"copy"}))}),gulp.task("fonts",function(){return gulp.src(["app/fonts/**"]).pipe(gulp.dest("dist/fonts")).pipe($.size({title:"fonts"}))}),gulp.task("html",function(){var e=$.useref.assets({searchPath:[".tmp","app","dist"]});return gulp.src(["app/**/*.html","!app/{elements,test}/**/*.html"]).pipe($["if"]("*.html",$.replace("elements/elements.html","elements/elements.vulcanized.html"))).pipe(e).pipe($["if"]("*.js",$.uglify({preserveComments:"some"}))).pipe($["if"]("*.css",$.cssmin())).pipe(e.restore()).pipe($.useref()).pipe($["if"]("*.html",$.minifyHtml({quotes:!0,empty:!0,spare:!0}))).pipe(gulp.dest("dist")).pipe($.size({title:"html"}))}),gulp.task("vulcanize",function(){var e="dist/elements";return gulp.src("dist/elements/elements.vulcanized.html").pipe($.vulcanize({dest:e,strip:!0,inlineCss:!0,inlineScripts:!0})).pipe(gulp.dest(e)).pipe($.size({title:"vulcanize"}))}),gulp.task("precache",function(e){var s="dist";glob("{elements,scripts,styles}/**/*.*",{cwd:s},function(t,p){if(t)e(t);else{p.push("index.html","./","bower_components/webcomponentsjs/webcomponents-lite.min.js");var i=path.join(s,"precache.json");fs.writeFile(i,JSON.stringify(p),e)}})}),gulp.task("clean",del.bind(null,[".tmp","dist"])),gulp.task("serve",["styles","elements","images"],function(){run("launch_gae_dev_server.bat").exec(),browserSync({notify:!1,snippetOptions:{rule:{match:'<span id="browser-sync-binding"></span>',fn:function(e){return e}}},proxy:"localhost:9080"}),gulp.watch(["app/**/*.html"],reload),gulp.watch(["app/styles/**/*.css"],["styles",reload]),gulp.watch(["app/elements/**/*.css"],["elements",reload]),gulp.watch(["app/{scripts,elements}/**/*.js"],["jshint"]),gulp.watch(["app/images/**/*"],reload)}),gulp.task("serve:dist",["default"],function(){run('python "C:Program Files (x86)Googlegoogle_appenginedevappserver.py" --port=9080 polymer-test'),browserSync({notify:!1,snippetOptions:{rule:{match:'<span id="browser-sync-binding"></span>',fn:function(e){return e}}},proxy:"localhost:9080"})}),gulp.task("default",["clean"],function(e){runSequence(["copy","styles"],"elements",["jshint","images","fonts","html"],"vulcanize","precache",e)});try{require("web-component-tester").gulp.init(gulp)}catch(err){}try{require("require-dir")("tasks")}catch(err){}